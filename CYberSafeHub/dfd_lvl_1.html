<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>CyberSafeHub ‚Äì DFD Level 1</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box
        }

        body {
            background: #fff;
            font-family: 'Segoe UI', Arial, sans-serif
        }

        #top {
            background: #1e293b;
            color: #fff;
            text-align: center;
            padding: 10px
        }

        #top h1 {
            font-size: 1.3rem;
            color: #38bdf8
        }

        #top p {
            font-size: .78rem;
            color: #94a3b8
        }

        #ctrl {
            display: flex;
            gap: 6px;
            justify-content: center;
            padding: 6px;
            background: #f1f5f9;
            border-bottom: 1px solid #e2e8f0;
            flex-wrap: wrap
        }

        .btn {
            padding: 4px 12px;
            border-radius: 4px;
            border: 1px solid #cbd5e1;
            background: #fff;
            cursor: pointer;
            font-size: .75rem;
            color: #334155
        }

        .btn:hover {
            background: #e2e8f0
        }

        #tabs {
            display: flex;
            gap: 0;
            justify-content: center;
            background: #e2e8f0
        }

        .tab {
            padding: 8px 28px;
            cursor: pointer;
            font-size: .85rem;
            font-weight: 600;
            border-bottom: 3px solid transparent;
            color: #64748b
        }

        .tab.active {
            border-color: #3b82f6;
            color: #1d4ed8;
            background: #fff
        }

        #wrap {
            overflow: auto;
            background: #fff;
            padding: 10px
        }

        canvas {
            display: block;
            margin: 0 auto
        }
    </style>
</head>

<body>
    <div id="top">
        <h1>üõ° CyberSafeHub ‚Äî Data Flow Diagram Level 1</h1>
        <p>Level 1.1: Admin Subsystem &nbsp;|&nbsp; Level 1.2: User Subsystem</p>
    </div>
    <div id="ctrl">
        <button class="btn" onclick="zoom(1.2)">Ôºã Zoom In</button>
        <button class="btn" onclick="zoom(0.83)">Ôºç Zoom Out</button>
        <button class="btn" onclick="resetZ()">‚ü≥ Reset</button>
        <button class="btn" onclick="window.print()">üñ® Print</button>
    </div>
    <div id="tabs">
        <div class="tab active" onclick="setTab(0)">Level 1.1 ‚Äì Admin</div>
        <div class="tab" onclick="setTab(1)">Level 1.2 ‚Äì User</div>
    </div>
    <div id="wrap"><canvas id="c"></canvas></div>

    <script>
        const canvas = document.getElementById('c');
        const ctx = canvas.getContext('2d');
        let sc = 1, activeTab = 0;

        // ‚îÄ‚îÄ‚îÄ ADMIN DATA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        const ADMIN = {
            title: 'LEVEL 1.1 : ADMIN SUBSYSTEM ‚Äî CyberSafeHub',
            actor: { label: 'Admin' },
            processes: [
                '1.1 Login & Auth\nVerification',
                '1.2 Manage Users\n(View / Block)',
                '1.3 View Threat\nIntelligence',
                '1.4 Platform Stats\n& Dashboard',
                '1.5 Manage\nConversion Jobs',
                '1.6 AI Governance\n& Prompt Control',
                '1.7 Academy LMS\nManagement',
                '1.8 Content\nManager',
                '1.9 Audit Logs\nReview',
            ],
            stores: [
                { label: 'Firebase Auth', color: '#dbeafe' },
                { label: 'Admin Collection\n(MongoDB)', color: '#dbeafe' },
                { label: 'ThreatLog\n(MongoDB)', color: '#fef3c7' },
                { label: 'PlatformStat\n(MongoDB)', color: '#fef3c7' },
                { label: 'Job Collection\n(MongoDB)', color: '#fef3c7' },
                { label: 'Gemini AI API', color: '#ede9fe' },
                { label: 'Academy Data\n(Static/DB)', color: '#d1fae5' },
                { label: 'Content Store\n(Firebase)', color: '#d1fae5' },
                { label: 'ActivityLog\n(localStorage)', color: '#fce7f3' },
            ],
            // [procIdx, storeIdx, dir] dir: 'to'=proc‚Üístore, 'from'=store‚Üíproc, 'both'
            edges: [
                [0, 0, 'both'], [0, 1, 'to'],
                [1, 1, 'from'], [1, 0, 'from'],
                [2, 2, 'from'],
                [3, 3, 'from'], [3, 2, 'from'],
                [4, 4, 'from'],
                [5, 5, 'both'],
                [6, 6, 'both'],
                [7, 7, 'both'],
                [8, 8, 'from'],
            ]
        };

        // ‚îÄ‚îÄ‚îÄ USER DATA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        const USER = {
            title: 'LEVEL 1.2 : USER SUBSYSTEM ‚Äî CyberSafeHub',
            actor: { label: 'User\n(Browser)' },
            processes: [
                '1.1 Register /\nLogin',
                '1.2 Password Vault\n(CRUD)',
                '1.3 Malware File\nScan',
                '1.4 Phishing URL\nCheck',
                '1.5 Security\nHealth Check',
                '1.6 WiFi Radar\nScan',
                '1.7 OSINT\nDetective',
                '1.8 AI Cyber\nAssistant',
                '1.9 File Format\nConversion',
                '1.10 Secure /\nNearby Share',
                '1.11 Metadata\nWasher',
                '1.12 Academy\nModules',
                '1.13 Settings &\nProfile',
            ],
            stores: [
                { label: 'Firebase Auth', color: '#dbeafe' },
                { label: 'VaultItem\n(MongoDB)', color: '#dbeafe' },
                { label: 'ThreatLog\n(MongoDB)', color: '#fef3c7' },
                { label: 'Google Safe\nBrowsing API', color: '#fef3c7' },
                { label: 'HealthCheck\nHistory (LS)', color: '#d1fae5' },
                { label: 'WiFi Devices\n(Runtime/ARP)', color: '#d1fae5' },
                { label: 'External Sites\n(OSINT ‚Äì HTTP)', color: '#fce7f3' },
                { label: 'Gemini AI API', color: '#ede9fe' },
                { label: 'Job Collection\n(MongoDB)', color: '#dbeafe' },
                { label: 'Socket.IO\n(Signaling Svr)', color: '#fce7f3' },
                { label: 'PlatformStat\n(MongoDB)', color: '#fef3c7' },
                { label: 'Academy Data\n(Static)', color: '#d1fae5' },
                { label: 'UserSettings &\nNotifPrefs (LS)', color: '#fce7f3' },
            ],
            edges: [
                [0, 0, 'both'],
                [1, 1, 'both'],
                [2, 2, 'to'],
                [3, 3, 'both'],
                [4, 4, 'both'],
                [5, 5, 'from'],
                [6, 6, 'both'],
                [7, 7, 'both'],
                [8, 8, 'both'], [8, 10, 'to'],
                [9, 9, 'both'],
                [10, 10, 'to'],
                [11, 11, 'from'],
                [12, 12, 'both'],
            ]
        };

        // ‚îÄ‚îÄ‚îÄ DRAW ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function draw() {
            const DATA = activeTab === 0 ? ADMIN : USER;
            const nP = DATA.processes.length;

            // Layout constants
            const PAD = 30, AX = PAD + 20, AW = 100, AH = 54;
            const PX = AX + AW + 90;         // process column x centre
            const PW = 158, PH = 48;
            const SX = PX + PW / 2 + 110;      // store column x centre
            const SW = 150, SH = 44, SR = 4;
            const ROW_H = 72;
            const TOP = 80;
            const W = SX + SW / 2 + PAD + 20;
            const H = TOP + nP * ROW_H + 60;

            canvas.width = Math.round(W * sc);
            canvas.height = Math.round(H * sc);
            ctx.setTransform(sc, 0, 0, sc, 0, 0);
            ctx.clearRect(0, 0, W, H);
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, W, H);

            // Title
            ctx.fillStyle = '#1e293b';
            ctx.font = 'bold 14px Segoe UI';
            ctx.textAlign = 'center';
            ctx.fillText(DATA.title, W / 2, 26);
            ctx.strokeStyle = '#cbd5e1'; ctx.lineWidth = 1;
            ctx.beginPath(); ctx.moveTo(PAD, 34); ctx.lineTo(W - PAD, 34); ctx.stroke();

            // Legend
            const LG = [['#dbeafe', 'Firebase/MongoDB'], ['#fef3c7', 'Internal APIs'], ['#d1fae5', 'Data/Static'], ['#ede9fe', 'AI Services'], ['#fce7f3', 'Runtime/LS']];
            let lx = PAD, ly = 44;
            ctx.font = '10px Segoe UI'; ctx.textAlign = 'left';
            LG.forEach(([c, t]) => {
                ctx.fillStyle = c; ctx.strokeStyle = '#94a3b8'; ctx.lineWidth = .8;
                ctx.fillRect(lx, ly, 14, 10); ctx.strokeRect(lx, ly, 14, 10);
                ctx.fillStyle = '#374151'; ctx.fillText(t, lx + 17, ly + 9); lx += t.length * 6.2 + 28;
            });

            // Actor box (left)
            const actorRows = DATA.processes.length;
            const actorTotalH = actorRows * ROW_H - ROW_H * 0.3;
            const actorY = TOP + ROW_H * actorRows / 2 - AH / 2;
            roundRect(ctx, AX, actorY, AW, AH, 6, '#f0f9ff', '#1d4ed8', 1.8);
            ctx.fillStyle = '#1e3a5f'; ctx.font = 'bold 12px Segoe UI'; ctx.textAlign = 'center';
            const al = DATA.actor.label.split('\n');
            al.forEach((l, i) => ctx.fillText(l, AX + AW / 2, actorY + AH / 2 - ((al.length - 1) * 7) + i * 14));

            // Process ovals + Store boxes + Arrows + actor‚Üíprocess lines
            DATA.processes.forEach((proc, pi) => {
                const py = TOP + pi * ROW_H + ROW_H / 2;

                // Oval (process)
                const ew = PW / 2, eh = PH / 2;
                ctx.fillStyle = '#fff'; ctx.strokeStyle = '#1d4ed8'; ctx.lineWidth = 1.6;
                ctx.beginPath(); ctx.ellipse(PX, py, ew, eh, 0, 0, Math.PI * 2); ctx.fill(); ctx.stroke();
                ctx.fillStyle = '#0c4a6e'; ctx.font = '11px Segoe UI'; ctx.textAlign = 'center';
                proc.split('\n').forEach((l, li) => {
                    const lines = proc.split('\n');
                    ctx.fillText(l, PX, py - ((lines.length - 1) * 7) + li * 14);
                });

                // Arrow: Actor ‚Üí Oval
                const actCX = AX + AW, actCY = actorY + AH / 2;
                const startY = actCY;
                ctx.strokeStyle = '#334155'; ctx.lineWidth = 1.2; ctx.setLineDash([]);
                ctx.beginPath();
                ctx.moveTo(actCX, actCY);
                // curved fan line from actor centre to left of oval
                ctx.bezierCurveTo(actCX + 30, actCY, PX - ew - 20, py, PX - ew, py);
                ctx.stroke();
                arrow(PX - ew - 1, py, 1, 0);

                // Find associated store for this process
                const edge = DATA.edges.find(e => e[0] === pi);
                if (edge) {
                    const si = edge[1], dir = edge[2];
                    const store = DATA.stores[si];
                    if (store) {
                        // Overlap stores that share an index to the same row position
                        const sy = TOP + si * ROW_H + ROW_H / 2;
                        const storeY = py; // align store row with process row
                        const sx = SX - SW / 2;

                        // Draw store if not already placed at this y
                        // (we draw it per-edge so overlapping uses same position ‚Äî actually draw per store index)
                        // ‚îÄ store box
                        roundRect(ctx, sx, py - SH / 2, SW, SH, SR, store.color, '#64748b', 1.2);
                        ctx.fillStyle = '#1e293b'; ctx.font = '10.5px Segoe UI'; ctx.textAlign = 'center';
                        store.label.split('\n').forEach((l, li) => {
                            const ls = store.label.split('\n');
                            ctx.fillText(l, SX, py - ((ls.length - 1) * 6.5) + li * 13);
                        });

                        // Arrow: Oval ‚Üî Store
                        const ox = PX + ew, oy = py;
                        const ex2 = SX - SW / 2;
                        if (dir === 'to') {
                            ctx.strokeStyle = '#0369a1'; ctx.lineWidth = 1.2;
                            line(PX + ew, py, SX - SW / 2, py); arrow(SX - SW / 2 + 1, py, -1, 0);
                        } else if (dir === 'from') {
                            ctx.strokeStyle = '#059669'; ctx.lineWidth = 1.2;
                            line(SX - SW / 2, py, PX + ew, py); arrow(PX + ew - 1, py, 1, 0);
                        } else {
                            ctx.strokeStyle = '#7c3aed'; ctx.lineWidth = 1.2;
                            line(PX + ew, py, SX - SW / 2, py);
                            arrow(SX - SW / 2 + 1, py, -1, 0); arrow(PX + ew - 1, py, 1, 0);
                        }
                    }
                }
            });

            // Arrow direction legend
            const dl = [[`#0369a1`, 'Process ‚Üí Store'], [`#059669`, 'Store ‚Üí Process'], [`#7c3aed`, 'Bidirectional']];
            let dx = W - 300, dy = 44;
            ctx.font = '10px Segoe UI'; ctx.textAlign = 'left';
            dl.forEach(([c, t]) => {
                ctx.strokeStyle = c; ctx.lineWidth = 1.5; ctx.setLineDash([]);
                ctx.beginPath(); ctx.moveTo(dx, dy + 5); ctx.lineTo(dx + 22, dy + 5); ctx.stroke();
                arrowSmall(dx + 22, dy + 5, 1, 0, c);
                ctx.fillStyle = '#374151'; ctx.fillText(t, dx + 26, dy + 9); dy += 16;
            });

            // Footer
            ctx.fillStyle = '#94a3b8'; ctx.font = 'italic 9.5px Segoe UI'; ctx.textAlign = 'center';
            ctx.fillText('CyberSafeHub DFD Level 1  |  React ¬∑ Express ¬∑ Firebase ¬∑ MongoDB ¬∑ Gemini AI ¬∑ Socket.IO', W / 2, H - 12);
        }

        function roundRect(ctx, x, y, w, h, r, fill, stroke, lw) {
            ctx.fillStyle = fill; ctx.strokeStyle = stroke; ctx.lineWidth = lw;
            ctx.beginPath();
            ctx.moveTo(x + r, y); ctx.lineTo(x + w - r, y);
            ctx.quadraticCurveTo(x + w, y, x + w, y + r); ctx.lineTo(x + w, y + h - r);
            ctx.quadraticCurveTo(x + w, y + h, x + w - r, y + h); ctx.lineTo(x + r, y + h);
            ctx.quadraticCurveTo(x, y + h, x, y + h - r); ctx.lineTo(x, y + r);
            ctx.quadraticCurveTo(x, y, x + r, y); ctx.closePath();
            ctx.fill(); ctx.stroke();
        }

        function line(x1, y1, x2, y2) {
            ctx.beginPath(); ctx.moveTo(x1, y1); ctx.lineTo(x2, y2); ctx.stroke();
        }

        function arrow(x, y, dx, dy) {
            const s = 6;
            ctx.fillStyle = ctx.strokeStyle;
            ctx.beginPath();
            ctx.moveTo(x, y);
            ctx.lineTo(x - dx * s - dy * 4, y - dy * s - dx * 4);
            ctx.lineTo(x - dx * s + dy * 4, y - dy * s + dx * 4);
            ctx.closePath(); ctx.fill();
        }

        function arrowSmall(x, y, dx, dy, c) {
            const s = 5; ctx.fillStyle = c;
            ctx.beginPath();
            ctx.moveTo(x, y);
            ctx.lineTo(x - dx * s, y - 4); ctx.lineTo(x - dx * s, y + 4);
            ctx.closePath(); ctx.fill();
        }

        function setTab(i) {
            activeTab = i;
            document.querySelectorAll('.tab').forEach((t, ti) => t.classList.toggle('active', ti === i));
            sc = 1; draw();
        }
        function zoom(f) { sc *= f; draw(); }
        function resetZ() { sc = 1; draw(); }

        draw();
    </script>
</body>

</html>